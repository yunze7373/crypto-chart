<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoRate Pro - æ•°å­—èµ„äº§æ±‡ç‡ç›‘æ§å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .current-info {
            background: #f8f9fa;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .info-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .op-price { color: #e74c3c; }
        .arb-price { color: #3498db; }
        .ratio-value { color: #27ae60; }
        
        .currency-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            border: 1px solid #dee2e6;
        }
        
        .selector-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .selector-group label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .selector-group select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
            min-width: 180px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .currency-input-container {
            position: relative;
            display: inline-block;
        }
        
        .currency-input-container input {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
            min-width: 180px;
            transition: all 0.3s;
            text-transform: uppercase;
        }
        
        .currency-input-container input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .currency-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .currency-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #f8f9fa;
            color: #495057;
        }
        
        .currency-option:hover {
            background: #f8f9fa;
        }
        
        .currency-option.highlighted {
            background: #667eea;
            color: white;
        }
        
        .currency-option.highlighted .currency-symbol {
            color: white;
        }
        
        .currency-option.highlighted .currency-name {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .currency-symbol {
            font-weight: bold;
            color: #667eea;
        }
        
        .currency-name {
            font-size: 12px;
            color: #6c757d;
            margin-left: 8px;
        }
        
        .selector-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .reverse-btn {
            font-size: 14px;
            font-weight: bold;
            color: #667eea;
            background: white;
            padding: 8px;
            border-radius: 50%;
            border: 2px solid #667eea;
            margin: 0 8px;
            cursor: pointer;
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .reverse-btn:hover {
            background: #667eea;
            color: white;
            transform: rotate(180deg);
        }
        
        .apply-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .apply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .chart-container {
            padding: 30px 30px 120px 30px; /* å¢åŠ åº•éƒ¨è¾¹è·ä¸º120pxï¼Œç¡®ä¿æ»‘è½´ä¸è¢«é®ç›– */
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .timespan-selector {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .timespan-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            color: #495057;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        
        .timespan-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .timespan-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        
        .refresh-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .time-range-slider {
            width: 100%;
            margin: 5px 0 0 0;
            padding: 0;
            background: transparent;
            border: none;
            box-sizing: border-box;
            /* è®¡ç®—å›¾è¡¨ç»˜å›¾åŒºåŸŸçš„è¾¹è·ï¼Œä¸Chart.jsçš„å¸ƒå±€å¯¹é½ */
            padding-left: 65px;  /* å·¦ä¾§Yè½´æ ‡ç­¾çš„å®½åº¦ */
            padding-right: 25px; /* å³ä¾§ç•™ç™½ */
        }
        
        .timeline-container {
            position: relative;
            height: 60px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin: 0;
            overflow: hidden;
        }
        
        .timeline-chart {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .timeline-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            pointer-events: none;
        }
        
        .timeline-selection {
            position: absolute;
            top: 0;
            height: 40px;
            background: rgba(102, 126, 234, 0.2);
            border-left: 2px solid #667eea;
            border-right: 2px solid #667eea;
            pointer-events: none;
        }
        
        .timeline-handle {
            position: absolute;
            top: 0;
            width: 2px;
            height: 40px;
            background: #667eea;
            cursor: ew-resize;
            z-index: 10;
        }
        
        .timeline-handle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -6px;
            width: 14px;
            height: 14px;
            background: #667eea;
            border: 2px solid #ffffff;
            border-radius: 50%;
            transform: translateY(-50%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
        }
        
        .timeline-handle:hover::before {
            background: #5a6fd8;
            transform: translateY(-50%) scale(1.1);
        }
        
        .timeline-handle.dragging::before {
            background: #4f5bd5;
            transform: translateY(-50%) scale(1.2);
        }
        
        .timeline-labels {
            position: absolute;
            bottom: 3px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #6c757d;
            font-weight: 500;
        }
        
        .timeline-info {
            text-align: center;
            margin-top: 5px;
            font-size: 11px;
            color: #6c757d;
            font-weight: 500;
        }
        
        .mini-chart {
            position: absolute;
            top: 3px;
            left: 5px;
            right: 5px;
            height: 37px;
            background: transparent;
        }
        
        .mini-chart svg {
            width: 100%;
            height: 100%;
        }
        
        .mini-chart-line {
            fill: none;
            stroke: #667eea;
            stroke-width: 1.5;
            opacity: 0.6;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
        }
        
        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .last-update {
            color: #666;
            font-size: 0.9em;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #e74c3c;
            background: #ffeaea;
            margin: 20px;
            border-radius: 10px;
        }
        
        .fiat-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            margin: 20px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .fiat-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .fiat-header h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.5em;
        }
        
        .fiat-header p {
            color: #6c757d;
            margin: 0;
        }
        
        .fiat-content {
            display: grid;
            gap: 25px;
        }
        
        .fiat-rate-display {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .rate-info {
            margin-bottom: 15px;
        }
        
        .rate-label {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .rate-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .rate-description {
            color: #495057;
            font-size: 1em;
        }
        
        .fiat-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .feature-icon {
            font-size: 1.2em;
        }
        
        .feature-text {
            color: #495057;
            font-weight: 500;
        }
        
        .fiat-suggestion {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 20px;
        }
        
        .fiat-suggestion p {
            margin: 0 0 10px 0;
            color: #1976d2;
            font-weight: 600;
        }
        
        .fiat-suggestion ul {
            margin: 0;
            padding-left: 20px;
            color: #1565c0;
        }
        
        .fiat-suggestion li {
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .container {
                margin: 10px;
            }
            
            .chart-container {
                padding: 20px 20px 100px 20px; /* ç§»åŠ¨ç«¯ä¹Ÿå¢åŠ åº•éƒ¨è¾¹è· */
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .timespan-selector {
                justify-content: center;
            }
            
            .refresh-controls {
                justify-content: space-between;
            }
            
            .timespan-btn {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            .time-range-slider {
                margin: 3px 0 0 0;
                padding-left: 45px;  /* ç§»åŠ¨ç«¯è°ƒæ•´å·¦è¾¹è· */
                padding-right: 15px; /* ç§»åŠ¨ç«¯è°ƒæ•´å³è¾¹è· */
            }
            
            .timeline-container {
                height: 55px;
            }
            
            .timeline-handle::before {
                width: 16px;
                height: 16px;
                left: -8px;
            }
            
            .timeline-info {
                font-size: 10px;
            }
            
            .timeline-labels {
                font-size: 9px;
            }
        }
        
        /* =================== ä»·æ ¼æé†’åŠŸèƒ½æ ·å¼ =================== */
        .alerts-section {
            background: #f8f9fa;
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .alerts-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .alerts-header h2 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
            font-weight: 300;
        }
        
        .alerts-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .alerts-content {
            padding: 20px;
        }
        
        .alert-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .alerts-list {
            background: white;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .alerts-list-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            border-radius: 10px 10px 0 0;
        }
        
        .alerts-list-header h3 {
            margin: 0;
            color: #495057;
            font-size: 1.1em;
        }
        
        .alert-item {
            padding: 20px;
            border-bottom: 1px solid #f8f9fa;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: center;
        }
        
        .alert-item:last-child {
            border-bottom: none;
        }
        
        .alert-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .alert-detail {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .alert-detail-label {
            font-size: 11px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .alert-detail-value {
            font-size: 14px;
            color: #495057;
            font-weight: 500;
        }
        
        .alert-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 6px;
        }
        
        .alert-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-triggered {
            background: #fff3cd;
            color: #856404;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(400px);
            transition: all 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #28a745;
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        .notification.info {
            background: #17a2b8;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CryptoRate Pro</h1>
            <p>ä¸“ä¸šçš„æ•°å­—èµ„äº§ä¸æ³•å¸æ±‡ç‡ç›‘æ§å¹³å°</p>
        </div>
        
        <div class="current-info" id="currentInfo">
            <div class="info-card">
                <h3 id="baseCurrencyLabel">åŸºç¡€è´§å¸ä»·æ ¼</h3>
                <div class="value op-price" id="basePrice">åŠ è½½ä¸­...</div>
            </div>
            <div class="info-card">
                <h3 id="quoteCurrencyLabel">è®¡ä»·è´§å¸ä»·æ ¼</h3>
                <div class="value arb-price" id="quotePrice">åŠ è½½ä¸­...</div>
            </div>
            <div class="info-card">
                <h3 id="ratioLabel">å…‘æ¢æ¯”ä¾‹</h3>
                <div class="value ratio-value" id="currentRatio">åŠ è½½ä¸­...</div>
            </div>
            <div class="info-card">
                <h3>æ›´æ–°æ—¶é—´</h3>
                <div class="value" id="updateTime" style="font-size: 1em;">åŠ è½½ä¸­...</div>
            </div>
        </div>
        
        <!-- è´§å¸å¯¹é€‰æ‹©å™¨ -->
        <div class="currency-selector">
            <div class="selector-group">
                <label>åŸºç¡€è´§å¸:</label>
                <div class="currency-input-container">
                    <input type="text" id="baseCurrency" placeholder="è¾“å…¥è´§å¸ä»£ç  (å¦‚: BTC)" autocomplete="off">
                    <div class="currency-dropdown" id="baseDropdown"></div>
                </div>
            </div>
            <button class="reverse-btn" onclick="reverseCurrencyPair()" title="ç‚¹å‡»äº¤æ¢è´§å¸å¯¹">â‡„</button>
            <div class="selector-group">
                <label>è®¡ä»·è´§å¸:</label>
                <div class="currency-input-container">
                    <input type="text" id="quoteCurrency" placeholder="è¾“å…¥è´§å¸ä»£ç  (å¦‚: USDT)" autocomplete="off">
                    <div class="currency-dropdown" id="quoteDropdown"></div>
                </div>
            </div>
            <button class="apply-btn" onclick="updateCurrencyPair()">ğŸ”„ æ›´æ–°</button>
        </div>

        <!-- ä»·æ ¼æé†’åŠŸèƒ½åŒºåŸŸ -->
        <div class="alerts-section">
            <div class="alerts-header">
                <h2>ğŸš¨ ä»·æ ¼æé†’</h2>
                <p>è®¾ç½®ä»·æ ¼æé†’ï¼Œé€šè¿‡Discordæ¥æ”¶å®æ—¶é€šçŸ¥</p>
            </div>
            <div class="alerts-content">
                <!-- åˆ›å»ºæé†’è¡¨å• -->
                <div class="alert-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>åŸºç¡€è´§å¸</label>
                            <input type="text" id="alertBaseCurrency" placeholder="å¦‚: BTC" style="text-transform: uppercase;">
                        </div>
                        <div class="form-group">
                            <label>è®¡ä»·è´§å¸</label>
                            <input type="text" id="alertQuoteCurrency" placeholder="å¦‚: USDT" style="text-transform: uppercase;">
                        </div>
                        <div class="form-group">
                            <label>æé†’æ¡ä»¶</label>
                            <select id="alertCondition">
                                <option value="above">ä»·æ ¼é«˜äº</option>
                                <option value="below">ä»·æ ¼ä½äº</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç›®æ ‡ä»·æ ¼</label>
                            <input type="number" id="alertTargetPrice" placeholder="0.0000" step="any" min="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Discord Webhook URL</label>
                            <input type="url" id="alertWebhookUrl" placeholder="https://discord.com/api/webhooks/...">
                        </div>
                        <div class="form-group">
                            <label>å¤‡æ³¨ (å¯é€‰)</label>
                            <textarea id="alertNote" placeholder="ä¸ºè¿™ä¸ªæé†’æ·»åŠ å¤‡æ³¨..."></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="testWebhook()">æµ‹è¯• Webhook</button>
                        <button type="button" class="btn btn-primary" onclick="createAlert()">åˆ›å»ºæé†’</button>
                    </div>
                </div>

                <!-- æé†’åˆ—è¡¨ -->
                <div class="alerts-list">
                    <div class="alerts-list-header">
                        <h3>ğŸ“‹ æˆ‘çš„æé†’åˆ—è¡¨</h3>
                    </div>
                    <div id="alertsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“­</div>
                            <p>æš‚æ— æé†’ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªä»·æ ¼æé†’å§ï¼</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="controls">
                <div class="timespan-selector">
                    <button class="timespan-btn" data-timespan="1d">1D</button>
                    <button class="timespan-btn" data-timespan="7d">7D</button>
                    <button class="timespan-btn active" data-timespan="30d">1M</button>
                    <button class="timespan-btn" data-timespan="90d">3M</button>
                    <button class="timespan-btn" data-timespan="1y">1Y</button>
                    <button class="timespan-btn" data-timespan="all">ALL</button>
                </div>
                <div class="refresh-controls">
                    <button class="refresh-btn" id="refreshBtn" onclick="loadAllData()">
                        ğŸ”„ åˆ·æ–°æ•°æ®
                    </button>
                    <div class="last-update">
                        æœ€åæ›´æ–°: <span id="lastUpdate">ä»æœª</span>
                    </div>
                </div>
            </div>
            
            <div id="loadingDiv" class="loading">
                ğŸ“ˆ æ­£åœ¨åŠ è½½å›¾è¡¨æ•°æ®...
            </div>
            
            <div id="errorDiv" class="error" style="display: none;">
                âŒ æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•
            </div>
            
            <!-- æ³•å¸ä¸“ç”¨æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="fiatInfoDiv" class="fiat-info" style="display: none;">
                <div class="fiat-header">
                    <h3>ğŸ’° æ³•å¸æ±‡ç‡æŸ¥è¯¢</h3>
                    <p>å®æ—¶æ±‡ç‡ä¿¡æ¯ - å†å²å›¾è¡¨åŠŸèƒ½å³å°†æ¨å‡º</p>
                </div>
                
                <div class="fiat-content">
                    <div class="fiat-rate-display">
                        <div class="rate-info">
                            <div class="rate-label">å½“å‰æ±‡ç‡</div>
                            <div class="rate-value" id="fiatRateValue">æ­£åœ¨è·å–...</div>
                        </div>
                        <div class="rate-description">
                            <span id="fiatRateDescription">1 åŸºç¡€è´§å¸ = X è®¡ä»·è´§å¸</span>
                        </div>
                    </div>
                    
                    <div class="fiat-features">
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ“Š</span>
                            <span class="feature-text">å®æ—¶æ±‡ç‡æŸ¥è¯¢</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ”„</span>
                            <span class="feature-text">è‡ªåŠ¨åˆ·æ–°æ•°æ®</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸŒ</span>
                            <span class="feature-text">æ”¯æŒä¸»æµæ³•å¸</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ“ˆ</span>
                            <span class="feature-text">å†å²å›¾è¡¨å³å°†æ¨å‡º</span>
                        </div>
                    </div>
                    
                    <div class="fiat-suggestion">
                        <p><strong>ğŸ’¡ å»ºè®®ï¼š</strong></p>
                        <ul>
                            <li>æŸ¥çœ‹å®æ—¶æ±‡ç‡å˜åŒ–</li>
                            <li>åˆ‡æ¢åˆ°åŠ å¯†è´§å¸å¯¹æŸ¥çœ‹å†å²å›¾è¡¨</li>
                            <li>ä½¿ç”¨åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°æ±‡ç‡</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="chart-wrapper">
                <canvas id="ratioChart" style="display: none;"></canvas>
                
                <!-- æ—¶é—´è½´ç´§è´´å›¾è¡¨ä¸‹æ–¹ -->
                <div class="time-range-slider" id="timeRangeSlider">
                    <div class="timeline-container" id="timelineContainer">
                        <!-- è¿·ä½ å›¾è¡¨èƒŒæ™¯ -->
                        <div class="mini-chart" id="miniChart">
                            <svg id="miniChartSvg">
                                <path id="miniChartPath" class="mini-chart-line" d=""></path>
                            </svg>
                        </div>
                        
                        <!-- è¦†ç›–å±‚ -->
                        <div class="timeline-overlay"></div>
                        
                        <!-- é€‰æ‹©åŒºåŸŸ -->
                        <div class="timeline-selection" id="timelineSelection"></div>
                        
                        <!-- æ‹–æ‹½æ‰‹æŸ„ -->
                        <div class="timeline-handle" id="leftHandle"></div>
                        <div class="timeline-handle" id="rightHandle"></div>
                        
                        <!-- æ—¶é—´æ ‡ç­¾ -->
                        <div class="timeline-labels" id="timelineLabels">
                            <span>å¼€å§‹</span>
                            <span>ç»“æŸ</span>
                        </div>
                    </div>
                    
                    <div class="timeline-info" id="timelineInfo">
                        æ‹–æ‹½é€‰æ‹©æ—¶é—´èŒƒå›´æŸ¥çœ‹è¯¦ç»†æ•°æ®
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ”¯æŒçš„åŠ å¯†è´§å¸å’Œæ³•å¸åˆ—è¡¨ï¼ˆæ›´æ–°åˆ°2025å¹´ï¼‰
        const supportedCurrencies = [
            // ä¸»æµæ³•å¸
            { symbol: 'USD', name: 'US Dollar', type: 'fiat' },
            { symbol: 'CNY', name: 'Chinese Yuan', type: 'fiat' },
            { symbol: 'EUR', name: 'Euro', type: 'fiat' },
            { symbol: 'JPY', name: 'Japanese Yen', type: 'fiat' },
            { symbol: 'GBP', name: 'British Pound', type: 'fiat' },
            { symbol: 'KRW', name: 'Korean Won', type: 'fiat' },
            { symbol: 'CAD', name: 'Canadian Dollar', type: 'fiat' },
            { symbol: 'AUD', name: 'Australian Dollar', type: 'fiat' },
            { symbol: 'CHF', name: 'Swiss Franc', type: 'fiat' },
            { symbol: 'HKD', name: 'Hong Kong Dollar', type: 'fiat' },
            { symbol: 'SGD', name: 'Singapore Dollar', type: 'fiat' },
            { symbol: 'INR', name: 'Indian Rupee', type: 'fiat' },
            
            // ä¸»æµç¨³å®šå¸
            { symbol: 'USDT', name: 'Tether', type: 'crypto' },
            { symbol: 'USDC', name: 'USD Coin', type: 'crypto' },
            
            // ä¸»æµåŠ å¯†è´§å¸
            { symbol: 'BTC', name: 'Bitcoin', type: 'crypto' },
            { symbol: 'ETH', name: 'Ethereum', type: 'crypto' },
            { symbol: 'BNB', name: 'Binance Coin', type: 'crypto' },
            { symbol: 'SOL', name: 'Solana', type: 'crypto' },
            { symbol: 'ADA', name: 'Cardano', type: 'crypto' },
            { symbol: 'AVAX', name: 'Avalanche', type: 'crypto' },
            { symbol: 'DOT', name: 'Polkadot', type: 'crypto' },
            { symbol: 'POL', name: 'Polygon', type: 'crypto' }, // æ›´æ–°MATICä¸ºPOL
            { symbol: 'LINK', name: 'Chainlink', type: 'crypto' },
            { symbol: 'ATOM', name: 'Cosmos', type: 'crypto' },
            { symbol: 'ICP', name: 'Internet Computer', type: 'crypto' },
            { symbol: 'NEAR', name: 'Near Protocol', type: 'crypto' },
            { symbol: 'APT', name: 'Aptos', type: 'crypto' },
            { symbol: 'ARB', name: 'Arbitrum', type: 'crypto' },
            { symbol: 'OP', name: 'Optimism', type: 'crypto' },
            { symbol: 'SUI', name: 'Sui', type: 'crypto' },
            { symbol: 'DOGE', name: 'Dogecoin', type: 'crypto' },
            { symbol: 'SHIB', name: 'Shiba Inu', type: 'crypto' },
            { symbol: 'LTC', name: 'Litecoin', type: 'crypto' },
            { symbol: 'BCH', name: 'Bitcoin Cash', type: 'crypto' },
            { symbol: 'XRP', name: 'Ripple', type: 'crypto' },
            { symbol: 'TRX', name: 'Tron', type: 'crypto' },
            { symbol: 'FTM', name: 'Fantom', type: 'crypto' },
            { symbol: 'ALGO', name: 'Algorand', type: 'crypto' },
            { symbol: 'VET', name: 'VeChain', type: 'crypto' },
            { symbol: 'FIL', name: 'Filecoin', type: 'crypto' },
            { symbol: 'MANA', name: 'Decentraland', type: 'crypto' },
            { symbol: 'SAND', name: 'The Sandbox', type: 'crypto' }
        ];

        let myChart = null;
        let currentTimespan = '30d';
        let allChartData = null; // å­˜å‚¨å®Œæ•´çš„å›¾è¡¨æ•°æ®
        let currentBaseCurrency = 'OP';
        let currentQuoteCurrency = 'ARB';
        let timeRangeSlider = {
            isActive: false,
            startPercent: 0,
            endPercent: 100,
            isDragging: false,
            activeHandle: null
        };
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            
            // åˆå§‹æ˜¾ç¤ºæ—¶é—´èŒƒå›´æ»‘å—ï¼ˆé»˜è®¤ä¸º30dï¼‰
            const showSlider = ['30d', '90d', '1y', 'all'].includes(currentTimespan);
            document.getElementById('timeRangeSlider').style.display = showSlider ? 'block' : 'none';
            timeRangeSlider.isActive = showSlider;
            
            // è®¾ç½®è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰
            setInterval(loadCurrentPrices, 5 * 60 * 1000);
            
            // æ·»åŠ æ—¶é—´è·¨åº¦é€‰æ‹©å™¨äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.timespan-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                    document.querySelectorAll('.timespan-btn').forEach(b => b.classList.remove('active'));
                    // ä¸ºå½“å‰æŒ‰é’®æ·»åŠ activeç±»
                    this.classList.add('active');
                    // æ›´æ–°å½“å‰æ—¶é—´è·¨åº¦
                    currentTimespan = this.dataset.timespan;
                    // é‡æ–°åŠ è½½å›¾è¡¨æ•°æ®
                    loadAllData();
                    
                    // æ˜¾ç¤ºæˆ–éšè—æ—¶é—´èŒƒå›´æ»‘å—ï¼ˆåªåœ¨è¾ƒé•¿æ—¶é—´è·¨åº¦æ—¶æ˜¾ç¤ºï¼‰
                    const showSlider = ['30d', '90d', '1y', 'all'].includes(currentTimespan);
                    document.getElementById('timeRangeSlider').style.display = showSlider ? 'block' : 'none';
                    timeRangeSlider.isActive = showSlider;
                    
                    if (showSlider) {
                        resetTimeRangeSlider();
                    }
                });
            });
            
            // åˆå§‹åŒ–æ—¶é—´èŒƒå›´æ»‘å—äº‹ä»¶
            initTimeRangeSlider();
            
            // åˆå§‹åŒ–æ»‘å—ä½ç½®
            resetTimeRangeSlider();
            
            // åˆå§‹åŒ–ç•Œé¢æ ‡ç­¾
            updateInterfaceLabels();
            
            // åˆå§‹åŒ–è´§å¸è¾“å…¥æ¡†
            initializeCurrencyInputs();
            
            // åˆå§‹åŠ è½½æ•°æ®
            loadAllData();
        });
        
        // åˆå§‹åŒ–è´§å¸è¾“å…¥æ¡†
        function initializeCurrencyInputs() {
            const baseInput = document.getElementById('baseCurrency');
            const quoteInput = document.getElementById('quoteCurrency');
            const baseDropdown = document.getElementById('baseDropdown');
            const quoteDropdown = document.getElementById('quoteDropdown');
            
            // è®¾ç½®åˆå§‹å€¼
            baseInput.value = currentBaseCurrency;
            quoteInput.value = currentQuoteCurrency;
            
            // ä¸ºåŸºç¡€è´§å¸è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶
            setupCurrencyInput(baseInput, baseDropdown, 'base');
            setupCurrencyInput(quoteInput, quoteDropdown, 'quote');
        }
        
        // è®¾ç½®è´§å¸è¾“å…¥æ¡†åŠŸèƒ½
        function setupCurrencyInput(input, dropdown, type) {
            input.addEventListener('input', function() {
                const query = this.value.toUpperCase();
                showCurrencyDropdown(dropdown, query, type);
            });
            
            input.addEventListener('focus', function() {
                const query = this.value.toUpperCase();
                showCurrencyDropdown(dropdown, query, type);
            });
            
            input.addEventListener('blur', function() {
                // å»¶è¿Ÿéšè—ï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´ç‚¹å‡»é€‰é¡¹
                setTimeout(() => {
                    dropdown.style.display = 'none';
                }, 200);
            });
            
            input.addEventListener('keydown', function(e) {
                const options = dropdown.querySelectorAll('.currency-option');
                const highlighted = dropdown.querySelector('.currency-option.highlighted');
                let newIndex = -1;
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (highlighted) {
                        newIndex = Array.from(options).indexOf(highlighted) + 1;
                    } else {
                        newIndex = 0;
                    }
                    if (newIndex >= options.length) newIndex = 0;
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (highlighted) {
                        newIndex = Array.from(options).indexOf(highlighted) - 1;
                    } else {
                        newIndex = options.length - 1;
                    }
                    if (newIndex < 0) newIndex = options.length - 1;
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (highlighted && highlighted.dataset.symbol) {
                        selectCurrency(highlighted.dataset.symbol, type);
                        dropdown.style.display = 'none';
                    } else if (this.value.trim().length >= 2) {
                        // å¦‚æœæ²¡æœ‰é«˜äº®é€‰é¡¹ä½†ç”¨æˆ·è¾“å…¥äº†è‡³å°‘2ä¸ªå­—ç¬¦ï¼Œç›´æ¥ä½¿ç”¨è¾“å…¥çš„å€¼
                        selectCurrency(this.value.trim().toUpperCase(), type);
                        dropdown.style.display = 'none';
                    }
                    return;
                } else if (e.key === 'Escape') {
                    dropdown.style.display = 'none';
                    return;
                }
                
                // æ›´æ–°é«˜äº®
                options.forEach(opt => opt.classList.remove('highlighted'));
                if (newIndex >= 0 && options[newIndex]) {
                    options[newIndex].classList.add('highlighted');
                }
            });
        }
        
        // æ˜¾ç¤ºè´§å¸ä¸‹æ‹‰é€‰é¡¹
        function showCurrencyDropdown(dropdown, query, type) {
            const filtered = supportedCurrencies.filter(currency => 
                currency.symbol.toLowerCase().includes(query.toLowerCase()) || 
                currency.name.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 12); // å¢åŠ æ˜¾ç¤ºé€‰é¡¹æ•°é‡
            
            dropdown.innerHTML = '';
            
            if (filtered.length === 0 && query.length >= 2) {
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è´§å¸ä½†ç”¨æˆ·è¾“å…¥äº†è‡³å°‘2ä¸ªå­—ç¬¦ï¼Œæä¾›ä¸€ä¸ª"ç›´æ¥ä½¿ç”¨"é€‰é¡¹
                const option = document.createElement('div');
                option.className = 'currency-option highlighted';
                option.dataset.symbol = query;
                option.innerHTML = `
                    <span class="currency-symbol">${query}</span>
                    <span class="currency-name">ç›´æ¥ä½¿ç”¨æ­¤è´§å¸ç¬¦å·</span>
                    <span class="currency-type" style="font-size: 10px; color: #888; margin-left: 5px;">ğŸ” å°è¯•æŸ¥è¯¢</span>
                `;
                
                option.addEventListener('click', () => {
                    selectCurrency(query, type);
                    dropdown.style.display = 'none';
                });
                
                dropdown.appendChild(option);
            } else if (filtered.length === 0) {
                dropdown.innerHTML = '<div class="currency-option">æœªæ‰¾åˆ°åŒ¹é…çš„è´§å¸ï¼Œè¯·è¾“å…¥æ›´å¤šå­—ç¬¦</div>';
            } else {
                filtered.forEach((currency, index) => {
                    const option = document.createElement('div');
                    option.className = 'currency-option';
                    option.dataset.symbol = currency.symbol;
                    if (index === 0) option.classList.add('highlighted');
                    
                    const typeIndicator = currency.type === 'fiat' ? 'ğŸ’°' : 'ğŸª™';
                    const typeText = currency.type === 'fiat' ? 'Fiat' : 'Crypto';
                    
                    option.innerHTML = `
                        <span class="currency-symbol">${currency.symbol}</span>
                        <span class="currency-name">${currency.name}</span>
                        <span class="currency-type" style="font-size: 10px; color: #888; margin-left: 5px;">${typeIndicator} ${typeText}</span>
                    `;
                    
                    option.addEventListener('click', () => {
                        selectCurrency(currency.symbol, type);
                        dropdown.style.display = 'none';
                    });
                    
                    dropdown.appendChild(option);
                });
                
                // å¦‚æœç”¨æˆ·è¾“å…¥çš„å†…å®¹ä¸å®Œå…¨åŒ¹é…ä»»ä½•è´§å¸ï¼Œä¹Ÿæä¾›"ç›´æ¥ä½¿ç”¨"é€‰é¡¹
                if (query.length >= 2 && !filtered.find(c => c.symbol.toLowerCase() === query.toLowerCase())) {
                    const option = document.createElement('div');
                    option.className = 'currency-option';
                    option.dataset.symbol = query;
                    option.innerHTML = `
                        <span class="currency-symbol">${query}</span>
                        <span class="currency-name">ç›´æ¥ä½¿ç”¨æ­¤è´§å¸ç¬¦å·</span>
                        <span class="currency-type" style="font-size: 10px; color: #888; margin-left: 5px;">ğŸ” å°è¯•æŸ¥è¯¢</span>
                    `;
                    
                    option.addEventListener('click', () => {
                        selectCurrency(query, type);
                        dropdown.style.display = 'none';
                    });
                    
                    dropdown.appendChild(option);
                }
            }
            
            dropdown.style.display = 'block';
        }
        
        // é€‰æ‹©è´§å¸
        function selectCurrency(symbol, type) {
            if (type === 'base') {
                document.getElementById('baseCurrency').value = symbol;
                currentBaseCurrency = symbol;
            } else {
                document.getElementById('quoteCurrency').value = symbol;
                currentQuoteCurrency = symbol;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤
            if (currentBaseCurrency === currentQuoteCurrency) {
                alert('åŸºç¡€è´§å¸å’Œè®¡ä»·è´§å¸ä¸èƒ½ç›¸åŒï¼');
                return;
            }
            
            // æ›´æ–°ç•Œé¢æ ‡ç­¾
            updateInterfaceLabels();
            
            // è‡ªåŠ¨åŠ è½½æ•°æ®
            loadAllData();
        }
        
        // æ›´æ–°è´§å¸å¯¹
        function updateCurrencyPair() {
            const baseCurrency = document.getElementById('baseCurrency').value;
            const quoteCurrency = document.getElementById('quoteCurrency').value;
            
            if (baseCurrency === quoteCurrency) {
                alert('åŸºç¡€è´§å¸å’Œè®¡ä»·è´§å¸ä¸èƒ½ç›¸åŒï¼');
                return;
            }
            
            currentBaseCurrency = baseCurrency;
            currentQuoteCurrency = quoteCurrency;
            
            // æ›´æ–°ç•Œé¢æ ‡ç­¾
            updateInterfaceLabels();
            
            // é‡æ–°åŠ è½½æ•°æ®
            loadAllData();
        }
        
        // åå‘è´§å¸å¯¹
        function reverseCurrencyPair() {
            const baseInput = document.getElementById('baseCurrency');
            const quoteInput = document.getElementById('quoteCurrency');
            
            // äº¤æ¢å€¼
            const tempBase = baseInput.value;
            baseInput.value = quoteInput.value;
            quoteInput.value = tempBase;
            
            // äº¤æ¢å…¨å±€å˜é‡
            const tempCurrency = currentBaseCurrency;
            currentBaseCurrency = currentQuoteCurrency;
            currentQuoteCurrency = tempCurrency;
            
            // æ›´æ–°ç•Œé¢æ ‡ç­¾å’Œæ•°æ®
            updateInterfaceLabels();
            loadAllData();
        }
        
        // æ›´æ–°ç•Œé¢æ ‡ç­¾
        function updateInterfaceLabels() {
            document.getElementById('baseCurrencyLabel').textContent = `${currentBaseCurrency} å½“å‰ä»·æ ¼`;
            document.getElementById('quoteCurrencyLabel').textContent = `${currentQuoteCurrency} å½“å‰ä»·æ ¼`;
            document.getElementById('ratioLabel').textContent = `${currentBaseCurrency}/${currentQuoteCurrency} æ¯”ä¾‹`;
        }
        
        // åŠ è½½æ‰€æœ‰æ•°æ®
        function loadAllData() {
            loadCurrentPrices();
            loadChartData();
        }
        
        // åŠ è½½å½“å‰ä»·æ ¼æ•°æ®
        async function loadCurrentPrices() {
            try {
                const response = await fetch(`/api/current_prices?base=${currentBaseCurrency}&quote=${currentQuoteCurrency}`);
                if (!response.ok) throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    document.getElementById('basePrice').textContent = `$${data.base_price}`;
                    document.getElementById('quotePrice').textContent = `$${data.quote_price}`;
                    document.getElementById('currentRatio').textContent = data.ratio.toFixed(4);
                    document.getElementById('updateTime').textContent = data.timestamp;
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('è·å–å½“å‰ä»·æ ¼å¤±è´¥:', error);
                document.getElementById('basePrice').textContent = 'è·å–å¤±è´¥';
                document.getElementById('quotePrice').textContent = 'è·å–å¤±è´¥';
                document.getElementById('currentRatio').textContent = 'è·å–å¤±è´¥';
            }
        }
        
        // åŠ è½½å›¾è¡¨æ•°æ®
        async function loadChartData() {
            const loadingDiv = document.getElementById('loadingDiv');
            const errorDiv = document.getElementById('errorDiv');
            const fiatInfoDiv = document.getElementById('fiatInfoDiv');
            const chartCanvas = document.getElementById('ratioChart');
            const refreshBtn = document.getElementById('refreshBtn');
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«æ³•å¸
            const fiatCurrencies = ['USD', 'CNY', 'EUR', 'JPY', 'GBP', 'KRW', 'CAD', 'AUD', 'CHF', 'HKD', 'SGD', 'INR'];
            const isBaseFiat = fiatCurrencies.includes(currentBaseCurrency);
            const isQuoteFiat = fiatCurrencies.includes(currentQuoteCurrency);
            
            if (isBaseFiat || isQuoteFiat) {
                // æ˜¾ç¤ºæ³•å¸ä¸“ç”¨ç•Œé¢
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'none';
                fiatInfoDiv.style.display = 'block';
                chartCanvas.style.display = 'none';
                document.getElementById('timeRangeSlider').style.display = 'none';
                
                // æ›´æ–°æ³•å¸ç•Œé¢çš„å†…å®¹
                updateFiatInterface();
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
                return;
            }
            
            try {
                // éšè—æ³•å¸ç•Œé¢ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
                fiatInfoDiv.style.display = 'none';
                loadingDiv.style.display = 'block';
                errorDiv.style.display = 'none';
                chartCanvas.style.display = 'none';
                refreshBtn.disabled = true;
                refreshBtn.textContent = 'ğŸ”„ åŠ è½½ä¸­...';
                
                // è·å–æ•°æ®ï¼Œä¼ é€’æ—¶é—´è·¨åº¦å‚æ•°å’Œè´§å¸å¯¹å‚æ•°
                const response = await fetch(`/api/data?timespan=${currentTimespan}&base=${currentBaseCurrency}&quote=${currentQuoteCurrency}`);
                
                const chartData = await response.json();
                
                // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
                if (!response.ok || chartData.error) {
                    throw new Error(chartData.error || chartData.message || 'æ•°æ®è·å–å¤±è´¥');
                }
                
                // å­˜å‚¨å®Œæ•´æ•°æ®ç”¨äºæ—¶é—´èŒƒå›´æ»‘å—
                allChartData = chartData;
                
                // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºå›¾è¡¨
                loadingDiv.style.display = 'none';
                chartCanvas.style.display = 'block';
                
                // å¦‚æœæ—¶é—´èŒƒå›´æ»‘å—æ¿€æ´»ï¼Œæ˜¾ç¤ºå®ƒ
                if (timeRangeSlider.isActive) {
                    document.getElementById('timeRangeSlider').style.display = 'block';
                    updateTimelineLabels();
                    createMiniChart();
                    setTimeout(() => {
                        updateTimelinePosition();
                    }, 100);
                }
                
                // æ ¹æ®æ—¶é—´èŒƒå›´æ»‘å—è¿‡æ»¤æ•°æ®
                const filteredData = filterDataByTimeRange(chartData);
                
                // å¦‚æœå·²å­˜åœ¨å›¾è¡¨å®ä¾‹ï¼Œå…ˆé”€æ¯
                if (myChart) {
                    myChart.destroy();
                }
                
                // åˆ›å»ºæ–°å›¾è¡¨
                const ctx = chartCanvas.getContext('2d');
                
                // æ ¹æ®æ—¶é—´è·¨åº¦è°ƒæ•´Xè½´æ ‡ç­¾æ˜¾ç¤º
                const getTimeLabelConfig = (timespan) => {
                    switch(timespan) {
                        case '1d': return { maxTicksLimit: 12, title: 'æ—¶é—´ (å°æ—¶)' };
                        case '7d': return { maxTicksLimit: 14, title: 'æ—¶é—´ (å¤©)' };
                        case '30d': return { maxTicksLimit: 15, title: 'æ—¶é—´ (å¤©)' };
                        case '90d': return { maxTicksLimit: 12, title: 'æ—¶é—´ (æœˆ)' };
                        case '1y': return { maxTicksLimit: 12, title: 'æ—¶é—´ (æœˆ)' };
                        case 'all': return { maxTicksLimit: 10, title: 'æ—¶é—´ (å¹´)' };
                        default: return { maxTicksLimit: 10, title: 'æ—¶é—´' };
                    }
                };
                
                const timeLabelConfig = getTimeLabelConfig(currentTimespan);
                
                myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: filteredData.labels,
                        datasets: [{
                            label: `${currentBaseCurrency}/${currentQuoteCurrency} å…‘æ¢æ¯”ä¾‹`,
                            data: filteredData.op_arb_data,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 2,
                            pointRadius: 1,
                            pointHoverRadius: 5,
                            tension: 0.1,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: timeLabelConfig.title,
                                    font: { size: 14 }
                                },
                                ticks: {
                                    maxTicksLimit: timeLabelConfig.maxTicksLimit,
                                    callback: function(value, index, values) {
                                        const label = this.getLabelForValue(value);
                                        // æ ¹æ®æ—¶é—´è·¨åº¦è°ƒæ•´æ˜¾ç¤ºæ ¼å¼ï¼ŒåŒ…å«å¹´ä»½
                                        if (currentTimespan === '1d') {
                                            // 1æ—¥å›¾æ˜¾ç¤ºå®Œæ•´æ—¶é—´
                                            if (label.includes(' ')) {
                                                const [date, time] = label.split(' ');
                                                const shortTime = time.substring(0, 5); // åªè¦æ—¶:åˆ†
                                                return `${date} ${shortTime}`;
                                            }
                                        } else {
                                            // å…¶ä»–æ—¶é—´è·¨åº¦æ˜¾ç¤ºå¹´-æœˆ-æ—¥
                                            if (label.includes(' ')) {
                                                const [date, time] = label.split(' ');
                                                return date; // è¿”å›å®Œæ•´æ—¥æœŸ YYYY-MM-DD
                                            }
                                        }
                                        return label;
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: `1 ${currentBaseCurrency} å¯å…‘æ¢çš„ ${currentQuoteCurrency} æ•°é‡`,
                                    font: { size: 14 }
                                },
                                beginAtZero: false
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        return `æ¯”ä¾‹: ${context.parsed.y.toFixed(4)}`;
                                    }
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
                
                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-CN');
                
            } catch (error) {
                console.error('åŠ è½½å›¾è¡¨æ•°æ®å¤±è´¥:', error);
                loadingDiv.style.display = 'none';
                fiatInfoDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                chartCanvas.style.display = 'none';
                
                // æ›´æ–°é”™è¯¯æ¶ˆæ¯
                const errorMessage = errorDiv.querySelector('p');
                if (error.message.includes('æ³•å¸') || error.message.includes('Fiat')) {
                    errorMessage.innerHTML = `
                        âš ï¸ ${error.message}<br>
                        <small style="color: #888;">æ‚¨ä»å¯ä»¥æŸ¥çœ‹å½“å‰ä»·æ ¼ä¿¡æ¯</small>
                    `;
                } else {
                    errorMessage.textContent = `âŒ æ•°æ®åŠ è½½å¤±è´¥ï¼š${error.message}`;
                }
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
            }
        }
        
        // æ›´æ–°æ³•å¸ç•Œé¢å†…å®¹
        async function updateFiatInterface() {
            try {
                // è·å–å½“å‰ä»·æ ¼æ•°æ®
                const response = await fetch(`/api/current_prices?base=${currentBaseCurrency}&quote=${currentQuoteCurrency}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    // æ›´æ–°æ±‡ç‡æ˜¾ç¤º
                    document.getElementById('fiatRateValue').textContent = data.ratio.toFixed(6);
                    document.getElementById('fiatRateDescription').textContent = 
                        `1 ${currentBaseCurrency} = ${data.ratio.toFixed(6)} ${currentQuoteCurrency}`;
                } else {
                    document.getElementById('fiatRateValue').textContent = 'è·å–å¤±è´¥';
                    document.getElementById('fiatRateDescription').textContent = 'æ— æ³•è·å–æ±‡ç‡ä¿¡æ¯';
                }
            } catch (error) {
                console.error('è·å–æ³•å¸æ±‡ç‡å¤±è´¥:', error);
                document.getElementById('fiatRateValue').textContent = 'è·å–å¤±è´¥';
                document.getElementById('fiatRateDescription').textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
            }
        }
        
        // åˆå§‹åŒ–æ—¶é—´èŒƒå›´æ»‘å—
        function initTimeRangeSlider() {
            const leftHandle = document.getElementById('leftHandle');
            const rightHandle = document.getElementById('rightHandle');
            const timelineContainer = document.getElementById('timelineContainer');
            
            let isDragging = false;
            let activeHandle = null;
            
            // é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
            function handleMouseDown(e, handle) {
                isDragging = true;
                activeHandle = handle;
                handle.classList.add('dragging');
                e.preventDefault();
                document.body.style.userSelect = 'none';
            }
            
            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
            function handleMouseMove(e) {
                if (!isDragging || !activeHandle) return;
                
                const rect = timelineContainer.getBoundingClientRect();
                const percent = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
                
                if (activeHandle.id === 'leftHandle') {
                    timeRangeSlider.startPercent = Math.min(percent, timeRangeSlider.endPercent - 2);
                } else {
                    timeRangeSlider.endPercent = Math.max(percent, timeRangeSlider.startPercent + 2);
                }
                
                updateTimelinePosition();
                updateChartWithTimeRange();
            }
            
            // é¼ æ ‡é‡Šæ”¾äº‹ä»¶
            function handleMouseUp() {
                if (isDragging) {
                    isDragging = false;
                    if (activeHandle) {
                        activeHandle.classList.remove('dragging');
                        activeHandle = null;
                    }
                    document.body.style.userSelect = '';
                }
            }
            
            // ç»‘å®šäº‹ä»¶
            leftHandle.addEventListener('mousedown', (e) => handleMouseDown(e, leftHandle));
            rightHandle.addEventListener('mousedown', (e) => handleMouseDown(e, rightHandle));
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
            
            // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            leftHandle.addEventListener('touchstart', (e) => handleMouseDown(e.touches[0], leftHandle));
            rightHandle.addEventListener('touchstart', (e) => handleMouseDown(e.touches[0], rightHandle));
            document.addEventListener('touchmove', (e) => {
                if (isDragging) handleMouseMove(e.touches[0]);
            });
            document.addEventListener('touchend', handleMouseUp);
        }
        
        // æ›´æ–°æ—¶é—´è½´ä½ç½®
        function updateTimelinePosition() {
            const leftHandle = document.getElementById('leftHandle');
            const rightHandle = document.getElementById('rightHandle');
            const timelineSelection = document.getElementById('timelineSelection');
            
            leftHandle.style.left = timeRangeSlider.startPercent + '%';
            rightHandle.style.left = timeRangeSlider.endPercent + '%';
            
            timelineSelection.style.left = timeRangeSlider.startPercent + '%';
            timelineSelection.style.width = (timeRangeSlider.endPercent - timeRangeSlider.startPercent) + '%';
            
            updateTimelineInfo();
        }
        
        // æ›´æ–°æ—¶é—´è½´ä¿¡æ¯æ˜¾ç¤º
        function updateTimelineInfo() {
            if (!allChartData) return;
            
            const totalLength = allChartData.labels.length;
            const startIndex = Math.floor((timeRangeSlider.startPercent / 100) * totalLength);
            const endIndex = Math.floor((timeRangeSlider.endPercent / 100) * totalLength);
            
            const startTime = allChartData.labels[startIndex] || allChartData.labels[0];
            const endTime = allChartData.labels[endIndex - 1] || allChartData.labels[totalLength - 1];
            
            // æ—¶é—´æ˜¾ç¤ºæ ¼å¼åŒ…å«å¹´ä»½
            const formatTime = (timeStr) => {
                const date = new Date(timeStr);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hour = String(date.getHours()).padStart(2, '0');
                const minute = String(date.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day} ${hour}:${minute}`;
            };
            
            document.getElementById('timelineInfo').textContent = `${formatTime(startTime)} - ${formatTime(endTime)}`;
        }
        
        // æ›´æ–°æ—¶é—´è½´æ ‡ç­¾
        function updateTimelineLabels() {
            if (!allChartData) return;
            
            const labels = document.getElementById('timelineLabels');
            const startTime = allChartData.labels[0];
            const endTime = allChartData.labels[allChartData.labels.length - 1];
            
            // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º - åŒ…å«å¹´ä»½
            const formatTime = (timeStr) => {
                const date = new Date(timeStr);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };
            
            labels.innerHTML = `<span>${formatTime(startTime)}</span><span>${formatTime(endTime)}</span>`;
        }
        
        // åˆ›å»ºè¿·ä½ å›¾è¡¨
        function createMiniChart() {
            if (!allChartData) return;
            
            const svg = document.getElementById('miniChartSvg');
            const path = document.getElementById('miniChartPath');
            
            const data = allChartData.op_arb_data;
            const width = svg.clientWidth || 400;
            const height = svg.clientHeight || 50;
            
            // è®¡ç®—æ•°æ®èŒƒå›´
            const minValue = Math.min(...data);
            const maxValue = Math.max(...data);
            const range = maxValue - minValue;
            
            // ç”Ÿæˆè·¯å¾„
            let pathData = '';
            data.forEach((value, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - ((value - minValue) / range) * height;
                
                if (index === 0) {
                    pathData += `M ${x} ${y}`;
                } else {
                    pathData += ` L ${x} ${y}`;
                }
            });
            
            path.setAttribute('d', pathData);
        }
        
        // é‡ç½®æ—¶é—´èŒƒå›´æ»‘å—
        function resetTimeRangeSlider() {
            timeRangeSlider.startPercent = 0;
            timeRangeSlider.endPercent = 100;
            updateTimelinePosition();
        }
        
        // æ ¹æ®æ—¶é—´èŒƒå›´è¿‡æ»¤æ•°æ®
        function filterDataByTimeRange(data) {
            if (!timeRangeSlider.isActive) return data;
            
            const totalLength = data.labels.length;
            const startIndex = Math.floor((timeRangeSlider.startPercent / 100) * totalLength);
            const endIndex = Math.floor((timeRangeSlider.endPercent / 100) * totalLength);
            
            return {
                labels: data.labels.slice(startIndex, endIndex),
                op_arb_data: data.op_arb_data.slice(startIndex, endIndex),
                op_prices: data.op_prices ? data.op_prices.slice(startIndex, endIndex) : [],
                arb_prices: data.arb_prices ? data.arb_prices.slice(startIndex, endIndex) : []
            };
        }
        
        // æ ¹æ®æ—¶é—´èŒƒå›´æ›´æ–°å›¾è¡¨
        function updateChartWithTimeRange() {
            if (!myChart || !allChartData) return;
            
            const filteredData = filterDataByTimeRange(allChartData);
            
            myChart.data.labels = filteredData.labels;
            myChart.data.datasets[0].data = filteredData.op_arb_data;
            myChart.data.datasets[0].label = `${currentBaseCurrency}/${currentQuoteCurrency} å…‘æ¢æ¯”ä¾‹`;
            myChart.options.scales.y.title.text = `1 ${currentBaseCurrency} å¯å…‘æ¢çš„ ${currentQuoteCurrency} æ•°é‡`;
            myChart.update('none'); // æ— åŠ¨ç”»æ›´æ–°ï¼Œæé«˜æ€§èƒ½
        }
        
        // =================== ä»·æ ¼æé†’åŠŸèƒ½ ===================
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
        
        // æµ‹è¯•Discord Webhook
        async function testWebhook() {
            const webhookUrl = document.getElementById('alertWebhookUrl').value.trim();
            
            if (!webhookUrl) {
                showNotification('è¯·è¾“å…¥Discord Webhook URL', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/alerts/test-webhook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ webhook_url: webhookUrl })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showNotification(result.message, 'success');
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                showNotification('æµ‹è¯•å¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        // åˆ›å»ºä»·æ ¼æé†’
        async function createAlert() {
            const baseCurrency = document.getElementById('alertBaseCurrency').value.trim().toUpperCase();
            const quoteCurrency = document.getElementById('alertQuoteCurrency').value.trim().toUpperCase();
            const conditionType = document.getElementById('alertCondition').value;
            const targetPrice = parseFloat(document.getElementById('alertTargetPrice').value);
            const webhookUrl = document.getElementById('alertWebhookUrl').value.trim();
            const note = document.getElementById('alertNote').value.trim();
            
            // éªŒè¯è¾“å…¥
            if (!baseCurrency || !quoteCurrency) {
                showNotification('è¯·è¾“å…¥åŸºç¡€è´§å¸å’Œè®¡ä»·è´§å¸', 'error');
                return;
            }
            
            if (baseCurrency === quoteCurrency) {
                showNotification('åŸºç¡€è´§å¸å’Œè®¡ä»·è´§å¸ä¸èƒ½ç›¸åŒ', 'error');
                return;
            }
            
            if (isNaN(targetPrice) || targetPrice <= 0) {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„ç›®æ ‡ä»·æ ¼', 'error');
                return;
            }
            
            if (!webhookUrl) {
                showNotification('è¯·è¾“å…¥Discord Webhook URL', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/alerts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        base_currency: baseCurrency,
                        quote_currency: quoteCurrency,
                        condition_type: conditionType,
                        target_price: targetPrice,
                        discord_webhook_url: webhookUrl,
                        note: note || null
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showNotification('ä»·æ ¼æé†’åˆ›å»ºæˆåŠŸï¼', 'success');
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('alertBaseCurrency').value = '';
                    document.getElementById('alertQuoteCurrency').value = '';
                    document.getElementById('alertTargetPrice').value = '';
                    document.getElementById('alertWebhookUrl').value = '';
                    document.getElementById('alertNote').value = '';
                    // åˆ·æ–°æé†’åˆ—è¡¨
                    loadAlerts();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                showNotification('åˆ›å»ºå¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        // åŠ è½½æé†’åˆ—è¡¨
        async function loadAlerts() {
            try {
                const response = await fetch('/api/alerts');
                const result = await response.json();
                
                const alertsList = document.getElementById('alertsList');
                
                if (result.status === 'success' && result.data.length > 0) {
                    alertsList.innerHTML = result.data.map(alert => `
                        <div class="alert-item">
                            <div class="alert-info">
                                <div class="alert-detail">
                                    <div class="alert-detail-label">è´§å¸å¯¹</div>
                                    <div class="alert-detail-value">${alert.base_currency}/${alert.quote_currency}</div>
                                </div>
                                <div class="alert-detail">
                                    <div class="alert-detail-label">æ¡ä»¶</div>
                                    <div class="alert-detail-value">${alert.condition_type === 'above' ? 'é«˜äº' : 'ä½äº'} ${alert.target_price}</div>
                                </div>
                                <div class="alert-detail">
                                    <div class="alert-detail-label">çŠ¶æ€</div>
                                    <div class="alert-detail-value">
                                        <span class="alert-status ${
                                            alert.is_triggered ? 'status-triggered' : 
                                            alert.is_active ? 'status-active' : 'status-inactive'
                                        }">
                                            ${alert.is_triggered ? 'å·²è§¦å‘' : alert.is_active ? 'æ´»è·ƒ' : 'å·²ç¦ç”¨'}
                                        </span>
                                    </div>
                                </div>
                                <div class="alert-detail">
                                    <div class="alert-detail-label">åˆ›å»ºæ—¶é—´</div>
                                    <div class="alert-detail-value">${new Date(alert.created_at).toLocaleString('zh-CN')}</div>
                                </div>
                                ${alert.note ? `
                                <div class="alert-detail">
                                    <div class="alert-detail-label">å¤‡æ³¨</div>
                                    <div class="alert-detail-value">${alert.note}</div>
                                </div>
                                ` : ''}
                            </div>
                            <div class="alert-actions">
                                ${!alert.is_triggered ? `
                                <button class="btn btn-sm ${alert.is_active ? 'btn-secondary' : 'btn-success'}" 
                                        onclick="toggleAlert(${alert.id})">
                                    ${alert.is_active ? 'ç¦ç”¨' : 'å¯ç”¨'}
                                </button>
                                ` : ''}
                                <button class="btn btn-sm btn-danger" onclick="deleteAlert(${alert.id})">åˆ é™¤</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    alertsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“­</div>
                            <p>æš‚æ— æé†’ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªä»·æ ¼æé†’å§ï¼</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½æé†’åˆ—è¡¨å¤±è´¥:', error);
                showNotification('åŠ è½½æé†’åˆ—è¡¨å¤±è´¥', 'error');
            }
        }
        
        // åˆ‡æ¢æé†’çŠ¶æ€
        async function toggleAlert(alertId) {
            try {
                const response = await fetch(`/api/alerts/${alertId}/toggle`, {
                    method: 'PATCH'
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showNotification(result.message, 'success');
                    loadAlerts();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                showNotification('æ“ä½œå¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        // åˆ é™¤æé†’
        async function deleteAlert(alertId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæé†’å—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/alerts/${alertId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showNotification('æé†’å·²åˆ é™¤', 'success');
                    loadAlerts();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                showNotification('åˆ é™¤å¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        // ä»å½“å‰è´§å¸å¯¹å¡«å……æé†’è¡¨å•
        function fillAlertFromCurrent() {
            const baseCurrency = document.getElementById('baseCurrency').value.trim().toUpperCase();
            const quoteCurrency = document.getElementById('quoteCurrency').value.trim().toUpperCase();
            
            if (baseCurrency) {
                document.getElementById('alertBaseCurrency').value = baseCurrency;
            }
            if (quoteCurrency) {
                document.getElementById('alertQuoteCurrency').value = quoteCurrency;
            }
        }
        
        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½æé†’åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            loadAlerts();
            
            // ç›‘å¬è´§å¸å¯¹è¾“å…¥å˜åŒ–ï¼Œè‡ªåŠ¨å¡«å……åˆ°æé†’è¡¨å•
            document.getElementById('baseCurrency').addEventListener('change', fillAlertFromCurrent);
            document.getElementById('quoteCurrency').addEventListener('change', fillAlertFromCurrent);
        });
    </script>
</body>
</html>
